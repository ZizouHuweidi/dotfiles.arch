# vi: foldmethod=marker foldlevel=0
# ft = swayconfig
include ~/.config/sway/themes/gruvbox.conf

#Settings {{{

set $mod Mod4
set $alt Mod1
set $gnome-schema org.gnome.desktop.interface

# font pango:JetBrains Mono Medium 8
font pango:FiraCode Nerd Font Mono 8


# Title bar text alignment
title_align center

# Gaps (Outer gaps are added to the inner gaps)
gaps inner 0
gaps outer 0

# Only enable gaps on a workspace when there is at least one container
smart_gaps on

# Activate smart borders (always)
smart_borders on
# Borders
default_border pixel 3
default_floating_border normal
# hide_edge_borders --i3 none
# Disable cursor jumping
# mouse_warping none
# focus_follows_mouse no
# tiling_drag disable

popup_during_fullscreen smart

# for_window [class=".*"] opacity 0.90
for_window [app_id=".*"] opacity 0.95
# for_window [app_id="kitty"] opacity 0.90

# }}}

# Output {{{
output * bg ~/Wallpapers/guts-forest.jpg fill
output * scale 1.2
# output * bg "#282828" solid_color
# }}}

# Inputs {{{

input * {
    xkb_layout  "us,ara"
    xkb_options "grp:alt_space_toggle,caps:swapescape"
    xkb_numlock enable
}

input type:touchpad {
    tap enabled
    natural_scroll disabled
    middle_emulation enabled
}



seat * {
	hide_cursor 8000  
  xcursor_theme Adwaita
}

# }}}

# Autostart {{{
# exec ~/.config/sway/bin/import-gsettings
exec /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1
exec swaync
# exec mako


set $WOBSOCK $XDG_RUNTIME_DIR/wob.sock
exec rm -f $WOBSOCK && mkfifo $WOBSOCK && tail -f $WOBSOCK | wob
exec systemctl --user import-environment DISPLAY WAYLAND_DISPLAY SWAYSOCK

exec ~/.config/sway/bin/wlaunch
# exec autotiling-rs
# exec python3 ~/.config/sway/bin/columns.py

exec gammastep-indicator
# exec /usr/lib/kdeconnectd -platform offscreen 
exec blueman-applet
exec mpd

exec wl-paste -t text --watch clipman store --no-persist
exec nm-applet --indicator

# GTK3 applications take a long time to start
exec systemctl --user import-environment DISPLAY WAYLAND_DISPLAY SWAYSOCK
exec hash dbus-update-activation-environment 2>/dev/null && \
     dbus-update-activation-environment --systemd DISPLAY WAYLAND_DISPLAY SWAYSOCK

# exec  "dbus-update-activation-environment --systemd --all; systemctl --user start sway-session.target"

exec swayidle -w \
	timeout 1200 'swaylock -f' \
	timeout 1500 'swaymsg "output * dpms off"' \
	resume 'swaymsg "output * dpms on"; swaylock -f'

# }}}

# keys {{{

# -- gestures

bindgesture swipe:right workspace next
bindgesture swipe:left workspace prev

bindgesture swipe:up workspace back_and_forth
bindgesture swipe:down workspace back_and_forth

# -- Apps --

bindsym $mod+Return exec kitty 
bindsym $mod+Control+Return exec thunar
bindsym $mod+e exec  wofi-emoji
bindsym $mod+Shift+e exec  code
bindsym $mod+Shift+v exec  kitty -e nvim
bindsym $mod+Shift+b exec  vivaldi-stable
bindsym $mod+Control+n exec swaync-client -t

# -- wofi --
bindsym $mod+d exec wofi --show drun
bindsym $mod+Control+c exec clipman pick -t wofi
bindsym $mod+x exec  wlogout --protocol layer-shell -b 5 -T 400 -B 400
bindsym $mod+Control+b exec  ~/.local/bin/books
bindsym $mod+Control+d exec ~/.local/bin/dmscripts/dm-confedit 

# -- Function keys --
bindsym XF86MonBrightnessDown exec brightnessctl set 10%- | sed -En 's/.*\(([0-9]+)%\).*/\1/p' > $WOBSOCK
bindsym XF86MonBrightnessUp exec brightnessctl set +10% | sed -En 's/.*\(([0-9]+)%\).*/\1/p' > $WOBSOCK
bindsym XF86AudioRaiseVolume exec pamixer -ui 5 && pamixer --get-volume > $WOBSOCK
bindsym XF86AudioLowerVolume exec pamixer -ud 5 && pamixer --get-volume > $WOBSOCK
bindsym XF86AudioMute exec pamixer --toggle-mute && ( [ "$(pamixer --get-mute)" = "true" ] && echo 0 > $WOBSOCK ) || pamixer --get-volume > $WOBSOCK

# bindsym $mod+XF86AudioRaiseVolume 			exec "playerctl --player org.gnome.Music next"
# bindsym $mod+XF86AudioLowerVolume 			exec "playerctl --player org.gnome.Music previous"
# bindsym $mod+XF86AudioMute 			exec "playerctl --player org.gnome.Music play-pause"

bindsym $mod+XF86AudioRaiseVolume 			exec "mpc next"
bindsym $mod+XF86AudioLowerVolume 			exec "mpc prev"
bindsym $mod+XF86AudioMute 			exec "mpc toggle"


# -- Screenshots --
# Screenshot whole screen
bindsym Print exec grim -t png $HOME/Pictures/Screenshots/$(date +'screenshot_%Y-%m-%d-%H%M%S.png')

# Screenshot region of screen
bindsym $mod+Print exec slurp | grim -t png -g - $HOME/Pictures/Screenshots/$(date +'screenshot_%Y-%m-%d-%H%M%S.png')

# Save screenshot to clipboard
bindsym $alt+Print exec grim -g "$(slurp)" -t png - | wl-copy -t image/png

# # Screenshot region then quick edit it
# bindsym Ctrl+Print exec grim -g "$(slurp)" -t png - | swappy -f -

# Screenshot current window
# bindsym $alt+Print exec swaymsg -t get_tree | jq -r '.. | select(.pid? and .visible?) | .rect | "\(.x),\(.y) \(.width)x\(.height)"' | slurp | grim -t png -g - $HOME/Pictures/Screenshots/Screenshot_2022-07-25-13-30-16_1366x768.png/$(date +'screenshot_%Y-%m-%d-%H%M%S.png')

# Parse text on screen and copy to clipboard
bindsym Ctrl+Print exec slurp | xargs -I {} grim -s 2 -t png -g {} - | tesseract - - | wl-copy -n

# }}}

# scratchpads {{{
bindsym $mod+Shift+minus move scratchpad
bindsym $mod+minus scratchpad show

bindsym $mod+Shift+Return exec ~/.config/sway/bin/sway-scratchpad --command "kitty" --mark term --width 75 --height 75
for_window [con_mark="SCRATCHPAD_term"] border pixel 5

bindsym $mod+Shift+s exec ~/.config/sway/bin/sway-scratchpad --command "pavucontrol" --mark sound --width 75 --height 75
for_window [con_mark="SCRATCHPAD_sound"] border pixel 5

bindsym $mod+m exec ~/.config/sway/bin/sway-scratchpad --command "kitty ncmpcpp" --mark mpc --width 50 --height 50
for_window [con_mark="SCRATCHPAD_mpc"] border pixel 5

bindsym $mod+Shift+f exec ~/.config/sway/bin/sway-scratchpad --command "kitty lf" --mark lf --width 75 --height 75
for_window [con_mark="SCRATCHPAD_lf"] border pixel 5

bindsym $mod+n exec ~/.config/sway/bin/sway-scratchpad --command "obsidian" --mark notes
for_window [con_mark="SCRATCHPAD_notes"] border pixel 5

# }}}

# sway keys {{{

# Lockscreen
bindsym $alt+Control+l exec swaylock

# sticky window
bindsym $mod+grave sticky toggle

# Restart/Quit sway session 
bindsym $mod+Shift+r reload
# Exit sway (logs you out of your Wayland session)
bindsym $mod+Shift+q exec sway exit

# Use Mouse+$mod to drag floating windows to their wanted position
floating_modifier $mod

# kill focused window
bindsym $mod+q kill

# change focus
bindsym $mod+h focus left
bindsym $mod+j focus down
bindsym $mod+k focus up
bindsym $mod+l focus right

# alternatively, you can use the cursor keys:
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

# move focused window
bindsym $mod+Shift+h move left
bindsym $mod+Shift+j move down
bindsym $mod+Shift+k move up
bindsym $mod+Shift+l move right

# split in horizontal orientation
bindsym $mod+b split h

# split in vertical orientation
bindsym $mod+v split v

# enter fullscreen mode for the focused container
bindsym $mod+f fullscreen toggle

# change container layout (stacked, tabbed, toggle split)
# bindsym $mod+s layout stacking
bindsym $mod+t layout tabbed
bindsym $mod+s layout toggle split

# toggle tiling / floating
bindsym $mod+Shift+space floating toggle

# change focus between tiling / floating windows
bindsym $mod+space focus mode_toggle

# focus the parent container
bindsym $mod+a focus parent

# focus the child container
bindsym $mod+Shift+d focus child

# }}}

# workspace {{{

# Define names for default workspaces for which we configure key bindings later on.
# We use variables to avoid repeating the names in multiple places.
set $ws1 "1"
set $ws2 "2"
set $ws3 "3"
set $ws4 "4"
set $ws5 "5"
set $ws6 "6"
set $ws7 "7"
set $ws8 "8"
set $ws9 "9"
set $ws10 "10"

workspace_auto_back_and_forth yes

bindsym $alt+Right workspace next
bindsym $alt+Left workspace prev
bindsym $alt+l workspace next
bindsym $alt+h workspace prev
bindsym $mod+Tab workspace back_and_forth

# switch to workspace
bindsym $mod+1 workspace number $ws1
bindsym $mod+2 workspace number $ws2
bindsym $mod+3 workspace number $ws3
bindsym $mod+4 workspace number $ws4
bindsym $mod+5 workspace number $ws5
bindsym $mod+6 workspace number $ws6
bindsym $mod+7 workspace number $ws7
bindsym $mod+8 workspace number $ws8
bindsym $mod+9 workspace number $ws9
bindsym $mod+0 workspace number $ws10
bindsym $mod+KP_1 workspace number $ws1
bindsym $mod+KP_2 workspace number $ws2
bindsym $mod+KP_3 workspace number $ws3
bindsym $mod+KP_4 workspace number $ws4
bindsym $mod+KP_5 workspace number $ws5
bindsym $mod+KP_6 workspace number $ws6
bindsym $mod+KP_7 workspace number $ws7
bindsym $mod+KP_8 workspace number $ws8
bindsym $mod+KP_9 workspace number $ws9
bindsym $mod+KP_0 workspace number $ws10

# move focused container to workspace
bindsym $mod+Shift+1 move container to workspace number $ws1
bindsym $mod+Shift+2 move container to workspace number $ws2
bindsym $mod+Shift+3 move container to workspace number $ws3
bindsym $mod+Shift+4 move container to workspace number $ws4
bindsym $mod+Shift+5 move container to workspace number $ws5
bindsym $mod+Shift+6 move container to workspace number $ws6
bindsym $mod+Shift+7 move container to workspace number $ws7
bindsym $mod+Shift+8 move container to workspace number $ws8
bindsym $mod+Shift+9 move container to workspace number $ws9
bindsym $mod+Shift+0 move container to workspace number $ws10
bindsym $mod+Control+KP_1 move container to workspace number $ws1
bindsym $mod+Control+KP_2 move container to workspace number $ws2
bindsym $mod+Control+KP_3 move container to workspace number $ws3
bindsym $mod+Control+KP_4 move container to workspace number $ws4
bindsym $mod+Control+KP_5 move container to workspace number $ws5
bindsym $mod+Control+KP_6 move container to workspace number $ws6
bindsym $mod+Control+KP_7 move container to workspace number $ws7
bindsym $mod+Control+KP_8 move container to workspace number $ws8
bindsym $mod+Control+KP_9 move container to workspace number $ws9
bindsym $mod+Control+KP_0 move container to workspace number $ws10

# }}}

# Resize / Move / Gaps {{{

bindsym $mod+Control+Left resize shrink width 10 px or 10 ppt
bindsym $mod+Control+Down resize grow height 10 px or 10 ppt
bindsym $mod+Control+Up resize shrink height 10 px or 10 ppt
bindsym $mod+Control+Right resize grow width 10 px or 10 ppt

bindsym $mod+Control+h resize shrink width 10 px or 10 ppt
bindsym $mod+Control+j resize grow height 10 px or 10 ppt
bindsym $mod+Control+k resize shrink height 10 px or 10 ppt
bindsym $mod+Control+l resize grow width 10 px or 10 ppt

bindsym $mod+Shift+Left move left 30px
bindsym $mod+Shift+Down move down  30px
bindsym $mod+Shift+Up move up 30px
bindsym $mod+Shift+Right move right 30px

# }}}

# Rules {{{

# Assign workspaces

# set floating (nontiling)for apps needing it:
for_window [class="Yad" instance="yad"] floating enable
for_window [app_id="yad"] floating enable
for_window [app_id="blueman-manager"] floating enable,  resize set width 40 ppt height 30 ppt
for_window [title="Picture-in-Picture"] sticky enable
# set floating (nontiling) for special apps:
for_window [class="Xsane" instance="xsane"] floating enable
# for_window [app_id="pavucontrol" ] floating enable, resize set width 40 ppt height 30 ppt
for_window [class="qt5ct" instance="qt5ct"] floating enable, resize set width 60 ppt height 50 ppt
for_window [class="Bluetooth-sendto" instance="bluetooth-sendto"] floating enable
for_window [class="Lxappearance"] floating enable, resize set width 60 ppt height 50 ppt

# set floating for window roles
for_window [window_role="pop-up"] floating enable
for_window [window_role="bubble"] floating enable
for_window [window_role="task_dialog"] floating enable
for_window [window_role="Preferences"] floating enable
for_window [window_type="dialog"] floating enable
for_window [window_type="menu"] floating enable
for_window [window_role="About"] floating enable
for_window [title="File Operation Progress"] floating enable, border pixel 1, sticky enable, resize set width 40 ppt height 30 ppt
for_window [app_id="firefox" title="Library"] floating enable, border pixel 1, sticky enable, resize set width 40 ppt height 30 ppt
for_window [app_id="firefox"] inhibit_idle fullscreen
for_window [app_id="floating_shell_portrait"] floating enable, border pixel 1, sticky enable, resize set width 30 ppt height 40 ppt
for_window [title="Picture in picture"] floating enable, sticky enable
for_window [app_id="xsensors"] floating enable
for_window [title="Save File"] floating enable
for_window [app_id="firefox" title="Firefox — Sharing Indicator"] kill

# Inhibit idle
for_window [app_id="firefox"] inhibit_idle fullscreen
for_window [app_id="brave-browser"] inhibit_idle fullscreen
# }}}

# Bar {{{

# hide waybar
bindsym $mod+p exec killall -SIGUSR1 waybar
# bindsym $mod+p bar mode toggle

bar {
	  swaybar_command waybar
}

# }}}

include /etc/sway/config.d/*
